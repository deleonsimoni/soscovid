<div id="wrapper">
  <div id="over_map">

    <section class="text-center" style="position: relative;margin-top: 155px;z-index: 1;">
      <div class="card" style="width: 18rem;">
        <div class="card-header" style="cursor: pointer;" (click)="exibirCategorias()">
          Em que pode ajudar? <i #categoriaSeta class="fa fa-chevron-down pull-right"></i>
        </div>
        <div id="categoriaSelect" style="max-height: 200px; overflow-y: auto;">


          <ul [style.display]="isCategoriaAberta ? 'block' : 'none'" *ngFor="let preCategoria of preCategorias"
            class="dontShow list-group list-group-flush">

            <li id="{{preCategoria.id}}" [ngClass]="{'success':preCategoriaSelecionada == preCategoria.id}"
              style="cursor: pointer;" (click)="mudarPreCategoria(preCategoria.id)" class="list-group-item text-left">
              <img *ngIf="preCategoria.icon" style="margin-right: 10px;" [src]="getIconCategoria(preCategoria.id)"
                width="30px" height="30px" />{{ preCategoria.name }}
              <span *ngIf="carregando" class="pull-right"><i style='text-align: center;'
                  class="fa fa-spinner fa-spin"></i></span>


              <ul *ngFor="let categoria of categorias" class="dontShow list-group list-group-flush">
                <li id="{{categoria.produto}}" [ngClass]="{'success':produtoSelecionado == categoria.produto}"
                  style="cursor: pointer;" (click)="mudarCategoria(categoria.produto)"
                  class="list-group-item text-left">
                  <img *ngIf="preCategoria.icon" style="margin-right: 10px;" [src]="getIconCategoria(preCategoria.id)"
                    width="30px" height="30px" />{{ categoria.produto }}
                  <span *ngIf="carregando" class="pull-right"><i style='text-align: center;'
                      class="fa fa-spinner fa-spin"></i></span>
                </li>

              </ul>



            </li>

          </ul>

        </div>
      </div>

      <div class="card" style="width: 18rem;">
        <div class="card-header" style="cursor: pointer; background-color: red; color: white;" (click)="modalSOS()">
          S.O.S Pedir Ajuda <i #categoriaSeta class="fa fa-exclamation-triangle  pull-right"></i>
        </div>
      </div>

    </section>
  </div>
  <agm-map [latitude]="location.lat" [zoom]="location.zoom" [longitude]="location.lng" [styles]="styles">

    <agm-marker *ngFor="let point of points" [iconUrl]="getIconCategoria(produtoSelecionado)"
      (markerClick)="selectMarker(point._id)" [latitude]="point.help.lat" [longitude]="point.help.lng">
    </agm-marker>

  </agm-map>
</div>

<ng-template #callHelp>
  <div class="modal-upload">
    <div class="modal-header">
      <h4 class="modal-title pull-left">Preciso de Ajuda!</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body" style="background-color: red; color: white; padding: 4px, 4px, 4px, 4px;">
      <div class="mt-2" *ngFor="let necessidade of necessidades; let i = index;">
        <button type="button" class="btn btn-danger" *ngIf="i > 0" (click)="removeHelpForm(i)">Remover</button>
        Suprimento
        <div class="">
          <select class="form-control mt-3" [(ngModel)]="necessidade.categoria">
            <option disabled="true" selected>Selecione a Categoria</option>
            <option *ngFor="let preCategoria of preCategorias" [ngValue]="preCategoria.id">{{preCategoria.name}}
            </option>
          </select>

          <input type="text" name="nome_{{i}}" class="form-control mt-3" id="abc613" placeholder="O que está faltando?"
            [(ngModel)]="necessidade.produto" />
        </div>

      </div>
      <button type="button" class="btn btn-success mt-2" (click)="addHelpForm()">+ Suprimentos</button>

      <textarea [(ngModel)]="help.obs" placeholder="Conte mais do que tem passado..." class="form-control mt-2"
        id="exampleFormControlTextarea1" rows="3"></textarea>

      <div class="justify-content-center">
        <button class="btn btn-primary mt-2" (click)="insertCallHelp()">Pedir Ajuda</button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #modalTemplate>
  <div class="modal-header">
    <div class="pull-left">
      <h4 class="modal-title">Somar forças</h4>
      <!--<b>Categoria:</b> {{getNameCategoria(produtoSelecionado)}}-->
    </div>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">


    <ngb-carousel *ngIf="!isAdmin" [showNavigationArrows]="false" [wrap]="false" [activeId]="'slideTwo'" interval="0">
      <ng-template ngbSlide>
        <mat-card class="mt-5 mt-sm-0 card">
          <!-- Titulo -->
          <mat-card-header>
            <mat-card-title>
              <h1> {{ userContent.fullname }}</h1>
            </mat-card-title>
          </mat-card-header>

          <!-- Conteudo -->
          <mat-card-content>
            <div class="row">
              <div class="col-12">

                Facebook: {{userContent.facebook}}

              </div>
              <div class="col-12">

                Instagram: {{userContent.instagram}}

              </div>

              <div class="col-12">

                celular: {{userContent.cellphone}}

              </div>

              <!-- Informações -->
              <div class="col-lg-5">
                Observação: {{ userContent.help.obs }}
              </div>

              <!-- fim infs -->

              <div class="col-sm-12">
                <mat-card-header>
                  <h3 class="mt-3 mt-sm-0">Produtos de necessidade</h3>
                </mat-card-header>

                <mat-card-header class="d-flex flex-row flex-wrap">
                  <div *ngFor="let necessidade of userContent.help.necessidades; let i = index;" class="m-2">
                    {{ necessidade.produto }}
                  </div>
                </mat-card-header>
              </div>
            </div>
          </mat-card-content>


        </mat-card>
      </ng-template>
    </ngb-carousel>


  </div>
</ng-template>
